let express,Notes;_ca0‍.w("express",[["default",["express"],function(v){express=v}]]);_ca0‍.w("../models/Notes",[["default",["Notes"],function(v){Notes=v}]]);


const route = express.Router()
// req => {obj, gId}

// route.get("/", async (req, res) => {
//   await Notes.find({}, (err, doc) => {
//     return res.json(doc)
//   })
// })

route.post("/", async (req, res) => {
  await Notes.findOne({ googleId: req.body.googleId }, (err, doc) => {
    if (doc) {
      let query = { id: req.body.id }
      let updateDoc = {
        $set: { "$.title": req.body.title },
      }
      _ca0‍.g.console.log(doc.notes)
      doc.notes.updateOne(query, updateDoc)
      return res.json(doc)
    } else res.json("Not found")
  })
})

route.post("/new", async (req, res) => {
  await Notes.findOne({ googleId: req.body.googleId }, async (err, doc) => {
    if (doc.notes.length === 0) {
      // first note
      doc.notes.push({
        id: 1,
        title: req.body.title,
        body: req.body.body,
        // private: req.body.private,
      })
      doc.save()
      return res.json(doc)
    } else {
      let newId = Math.max.apply(
        Math,
        doc.notes.map((o) => {
          return o.id
        })
      ) // largest ID number

      doc.notes.push({
        id: newId + 1,
        title: req.body.title,
        body: req.body.body,
        // private: req.body.private,
      })
      doc.save()
      return res.json(doc)
    }
  }).exec()
})

route.post("/edit", async (req, res) => {
  await Notes.findOne({ googleId: req.body.googleId }, async (err, doc) => {
    if (doc) {
      _ca0‍.g.console.log(doc)
    }
  }).exec()
})

module.exports = route
