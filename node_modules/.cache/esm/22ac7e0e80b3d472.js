let express,Notes;_80b‍.w("express",[["default",["express"],function(v){express=v}]]);_80b‍.w("../models/Notes",[["default",["Notes"],function(v){Notes=v}]]);


const route = express.Router()
// req => {obj, gId}

route.post("/", async (req, res) => {
  await Notes.findOne({ googleId: req.body.googleId }, (err, doc) => {
    _80b‍.g.console.log(doc.notes)
    return res.json(doc)
  })
})

route.put("/new", async (req, res) => {
  await Notes.findOne({ googleId: req.body.googleId }, async (err, doc) => {
    if (doc.notes.length === 0) {
      // first note
      doc.notes.push({
        id: 1,
        title: req.body.title,
        body: req.body.body,
        private: req.body.private,
      })
      doc.save()
      return res.json(doc)
    } else {
      let newId = Math.max.apply(
        Math,
        doc.notes.map((o) => {
          return o.id
        })
      ) // largest ID number

      doc.notes.push({
        id: newId + 1,
        title: req.body.title,
        body: req.body.body,
        private: req.body.private,
      })
      doc.save()
      return res.json(doc)
    }
  }).exec()
})

module.exports = route
